# 小程序基础知识点

## 一、小程序项目的结构

### 1、pages

pages文件夹是小程序的页面，一个子文件夹代表一个页面；

一个子文件夹下默认有四个文件：`js`文件、json文件、wxml文件、wxss文件。

​	js文件：小程序页面的逻辑层

​	json文件：小程序页面的配置

​	wxml文件：小程序页面骨架，相当于web前端中的html文件

​	wxss文件：小程序页面样式，相当于web前端中的css文件

### 2、utils

utils文件夹可以用来存放小程序的公用方法，是一个工具文件，通过module.exports将方法导出，提供给其他页面使用

### 3、app.js

小程序主要逻辑层，用来注册小程序，一定要有。

通过App()这个方法注册小程序，在其他页面可以通过getApp()这个方法来获取应用实例。

举个栗子：

```js
// app.js文件代码
App({
    globalData: {
		userInfo: 'balabala'
    }
})
// 在其他页面的js文件中
const app = getApp()
// 通过 app.globalData.userInfo可以获取到app.js文件中的数据
```

### 4、app.json

小程序的公共配置，一定要有

```json
{
  // pages代表小程序页面路由，我们可以在这里配置页面，排在第一个的路由代表启动小程序时的初始页面
  "pages":[
    "pages/index/index",
    "pages/logs/logs"
  ],
  // window主要是用来配置窗口的信息及样式
  "window":{
    "backgroundTextStyle":"light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "Weixin",
    "navigationBarTextStyle":"black"
  },
  "style": "v2",
  "sitemapLocation": "sitemap.json" // 站点文件，主要写小程序的一些索引，方便微信搜索，提高曝光率
}
```

小程序页面中的json文件配置会覆盖掉这些公共的配置

### 5、app.wxss

小程序的公共样式，可有可无

小程序页面中的wxss文件配置会覆盖掉这些公共的样式

### 6、project.config.json

项目配置文件，新建项目时自动生成，自动写好，一般不需要去修改它

### 如何新建一个页面

首先，在pages文件夹下新建一个文件夹，用来表示需要新建的页面，鼠标右击新建的文件夹，选择新建Page，自动生成页面默认所需的四个文件

然后，在app.json文件中的pages添加新建页面的路径

## 二、小程序基础组件以及特有的尺寸单位

### 基础组件

#### 0、view

小程序中没有div、span等标签，它的view标签就相当于web前端中的div标签

**view不是小程序的基础组件**

#### 1、text

相当于web前端中的span标签，其space的有效值和富文本的space属性有效值一样

| 属性        | 类型    | 默认值 | 必填 | 说明                                                | 最低版本                                                     |
| :---------- | :------ | :----- | :--- | :-------------------------------------------------- | :----------------------------------------------------------- |
| selectable  | boolean | false  | 否   | 文本是否可选 (已废弃)                               | [1.1.0](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| user-select | boolean | false  | 否   | 文本是否可选，该属性会使文本节点显示为 inline-block | [2.12.1](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| space       | string  |        | 否   | 显示连续空格                                        | [1.4.0](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| decode      | boolean | false  | 否   | 是否解码                                            | [1.4.0](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |

#### 2、icon

icon图标，组件长度单位默认是px，有三个属性：color、size、type

①type：必填项，有效值：success、success_no_circle、info、warn、waiting、cancel、download、search、clear

![image-20210115132125781](D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210115132125781.png)

②size：选填项，默认值是23

③color：选填项

#### 3、progress

进度条，常用的有个属性：percent、show-info、border-radius

①percent：选填项，进度条百分比，值是0~100的数值类型

②show-info：选填项，是否显示进度条百分比，默认值是false

③border-radius：选填项，进度条四个角的圆角弧度，默认值是0，其值后面不需要加单位

④font-size：选填项，设置show-info百分比字体大小，默认是16

⑤stroke-width：选填项，进度条线的宽度，默认是6

⑥activeColor：选填项，进度条颜色，默认是绿色

⑦backgroundColor：选填项，进度条背景颜色，默认是白色

⑧active：进度条动画，默认为false

#### 4、rich-text

富文本，有两个属性：nodes、space

①nodes：选填项，其值可以为节点列表/HTML String，即可以传入HTML标签

```html
<rich-text nodes="{{nodeStr}}"></rich-text>
```

```javascript
// 简写方法
data: {
	nodeStr: "<div class='div-class' style='line-height: 20px; color: blue;'>Hello&nbsp;World!</div>"
}
// 官方写法
data: {
	nodeStr: [{
        name:　'div',
        attrs: {
            class: 'div-class',
            style: 'line-height: 20px; color: blue;'
        },
        children: [{
            type: text,
            text: 'Hello&nbsp;World!'
        }]
    }]
}
```

②space：选填项，有三个有效值：

| 值   | 说明                   | 最低版本 |
| :--- | :--------------------- | :------- |
| ensp | 中文字符空格一半大小   |          |
| emsp | 中文字符空格大小       |          |
| nbsp | 根据字体设置的空格大小 |          |

### 尺寸单位rpx

可以根据屏幕宽度自适应，规定屏幕宽度为750px

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210113154836616.png" alt="image-20210113154836616" style="zoom:50%;" />



## 三、小程序生命周期

### 1、onLaunch

监听小程序初始化

### 2、onShow

监听小程序启动或者切前台的操作

### 3、onHide

监听小程序切后台的操作

### 4、onError

错误监听函数，当小程序发生错误时触发

### 5、onPageNotFound

页面不存在监听函数，当页面不存在时触发

## 四、小程序页面的生命周期

### 1、onLoad

监听页面加载，当页面加载完成后触发

### 2、onShow

监听页面显示，当页面显示出来时触发

### 3、onReady

监听页面初次渲染完成，当页面渲染完成后触发

### 4、onHide

监听页面隐藏，切后台或者切换到其他页面均会触发这个函数

### 5、onUnload

监听页面卸载，关闭当前页面时触发

### **注意**

每个页面的onLoad、onReady函数只会触发一次，此后即使跳转到其他页面再跳转回来，也不会再次触发

## 五、小程序知识点

### 1、小程序没有DOM

小程序没有DOM概念，所以在js文件中无法使用document.getElementById()等等来获取页面中的DOM元素

### 2、数据绑定

小程序的数据绑定是单向数据绑定，使用{{}}进行数据绑定，这点与vue一样，但是vue是数据双向绑定；

### 3、数据赋值

```js
/* 在vue中 */
data() {
    str: 'jack',
    age: 18
}
// 改变data中的值
this.str = 'john' // 这样页面(视图)上数据也会跟着改变

/* 在小程序中 */
data: {
    str: 'jack',
    age: 18
}
// 改变data中的值
this.data.str = 'john' // 由于小程序是数据单向绑定，赋值之后页面数据并不会变化
this.setData(this.data) // 调用this.setData()，驱动视图更新
```

### 4、条件渲染

```html
<!-- 在vue中 -->
<div v-if="flag"></div>
<div v-else-if="flag"></div>
<div v-else></div>
<!-- 在小程序中 -->
<view wx:if="{{flag}}"></view>
<view wx:elif="{{flag}}"></view>
<view wx:else></view>
```

### 5、循环渲染

```html
<!-- 在vue中 -->
<div v-for="(item, index) in list" :key="item.id">
	......
</div>

<!-- 在小程序中 -->
<block wx:for="{{ list }}" wx:for-item="item" wx:key="id" wx:for-index="index">
	<!-- 
		可以使用block标签，也可以使用view标签；
		在小程序中使用循环渲染和vue有较大的区别，可以不声明wx:for-item和wx:for-index，然后直接使用item和index来表示列表的每一项和索引值，这个是默认的，可以不写出来，绑定key值时直接使用列表项中的唯一值，不需要像vue一样使用item.id
	-->
</block>
```

### 6、小程序事件

小程序在绑定事件时需要在事件前面加bind，以下事件都是冒泡事件

#### 6.1 tap

触摸后马上离开时触发，相当于点击事件

```html
<!-- 在vue中，v-on:可以缩写为@ -->
<button v-on:click="changeSomething()">点击按钮</button>
<button @click="changeSomething()">点击按钮</button>

<!-- 在小程序中，bind后面的:可以省略 -->
<button bind:tap="changeSomething">点击按钮</button>
<button bindtap="changeSomething">点击按钮</button>
```

#### 6.2 touchstart

手指触摸动作开始时触发

#### 6.3 touchmove

手指触摸后移动

#### 6.4 touchcancel

手指触摸动作被打断，如来电提醒，弹窗

#### 6.5 touchend

手指触摸动作结束

#### 6.6 longpress

手指触摸后，超过350ms再离开，如果指定了事件回调函数并触发了这个事件，tap事件将不被触发

#### 6.7 longtap

手指触摸后，超过350ms再离开(推荐使用longpress事件代替)

### 7、小程序中catch和bind的区别

bind会触发事件冒泡机制

catch会阻止事件冒泡

```html
<view bindtap="containerPrint">
    <text bindtap="textPrint">文本</text>
</view>

<view bindtap="containerPrint">
    <text catchtap="textPrint">文本</text>
</view>

<view catchtap="containerPrint">
    <text catchtap="textPrint">文本</text>
</view>
```

```js
containerPrint: function() {
	console.log("container")
},
textPrint: function() {
	console.log("text")
}
// 第一个view中，点击text文本时由于冒泡事件，会触发父元素上对应的事件
// 第二和第三个view中，点击text均不会触发父元素上的对应的事件
```

### 8、小程序事件冒泡与捕获

```html
<!-- 在小程序中，
	事件捕获阶段使用capture-bind，后面冒号不能省略；
	中断事件捕获阶段用capture-catch，但是同时冒泡事件也被取消了
-->
<view bindtap="containerTap" capture-bind:tap="captureTap">
	<text bindtap="txtTap" capture-bind:tap="captureTap2">小程序</text>
</view>
<!--
	当点击文本时，输出captureTap、captureTap2、text、container
    先是事件捕获阶段，触发父元素上的capture-bind:tap事件以及子元素上的capture-bind:tap事件
    然后是事件冒泡阶段，触发子元素上的bindtap事件以及父元素上的bindtap事件
-->
<view bindtap="containerTap" capture-bind:tap="captureTap">
	<text bindtap="txtTap" capture-catch:tap="captureTap2">小程序</text>
</view>
<!--
	当点击文本时，输出captureTap、captureTap2
    先是事件捕获阶段，触发父元素上的capture-bind:tap事件以及子元素上的capture-catch:tap事件
	但是子元素使用了中断事件捕获和取消事件冒泡的capture-catch:tap，导致后面的text、container没有输出
-->
```

```js
containerTap: function() {
	console.log("container")
},
captureTap: function() {
	console.log("captureTap")
},
txtTap: function() {
	console.log("text")
},
captureTap2: function() {
	console.log("captureTap2")
}
```

## 六、小程序的from表单组件

### 1、input

小程序的input组件和html的input组件类似，区别在于方法的绑定不同，常见的事件有：bindinput(键盘输入时触发)、bindfocus(输入框聚焦时触发)、bindblur(输入框失去焦点时触发)、bindconfirm(点击完成按钮时触发)；

input有一个属性为password，默认为false，当输入框为输入密码时，将该属性赋为true即可，而不是将type设置为password

具体可以参考：https://developers.weixin.qq.com/miniprogram/dev/component/input.html

### 2、checkbox和radio以及checkbox-group和radio-group

小程序的checkbox、radio的用法跟HTML的一样

checkbox-group、radio-group有一个绑定的事件：bindchange，当checkbox-group/radio-group里面的选项发生变化时触发

由于小程序是数据单向绑定，如果要给checkbox的checked一个默认值，当点击选择/取消时需要手动改变原先的默认值

### 3、textarea

文本框，用法和HTML中的textarea标签一样，属性中有一个auto-height，表示是否自动增高，设置auto-height时，style.height不生效

### 4、form

form组件有两个常用的事件：bindsubmit和bindreset，当点击的button的form-type为submit时，会触发form表单的bindsubmit事件，当点击的button的form-type为reset时，会触发form表单的bindreset事件

### 5、button

在form表单中主要用来做提交按钮和重置按钮，其对应的form-type为submit和reset，不过需要注意的一点是，使用提交或者重置按钮，需要给标签一个name属性。

**举个栗子**

```html
<form bindsubmit="formSubmit" bindreset="formReset">
    <view>
        <view>输入框input</view>
        <input type="text" name="name" placeholder="请输入姓名" value="{{inputName}}" bindinput="inputName" />
        <input type="text" name="age" placeholder="请输入年龄" value="{{inputAge}}" bindinput="inputAge" />
    </view>
    <view>
        <view>复选框</view>
        <checkbox-group name="fruit" bindchange="cbChange">
            <block wx:for="{{fruitList}}" wx:for-item="fruit" wx:key="value">
                <checkbox value="{{fruit.value}}" />{{fruit.label}}
            </block>
        </checkbox-group>
    </view>
    <view>
        <view>单选框</view>
        <radio-group name="food" bindchange="radioChange">
            <block wx:for="{{foodList}}" wx:for-item="food" wx:key="value">
                <radio value="{{food.value}}" ></radio>{{food.label}}
            </block>
        </radio-group>
    </view>
    <view>
        <button form-type="submit">提交</button>
    </view>
    <view>
        <button form-type="reset">重置</button>
    </view>
</form>

```

```js
data: {
    inputName: '',
    inputAge: '', // 用来保存input输入框的内容
    cbVal: '', // 用来保存checkbox复选框的选中项
    radioVal: '', // 用来保存radio单选框的选中项
    fruitList: [
        {
            label: 'apple',
            value: 'apple'
        },
        {
            label: 'banana',
            value: 'banana'
        },
        {
            label: 'pear',
            value: 'pear'
        },
        {
            label: 'orange',
            value: 'orange'
        },
    ],
    foodList: [
        {
            label: 'cake',
            value: 'cake'
        },
        {
            label: 'snake',
            value: 'snake'
        },
        {
            label: 'bear',
            value: 'bear'
        },
        {
            label: 'beaf',
            value: 'beaf'
        },
    ]
},

inputName: function(e) {
    this.data.inputName = e.detail.value
    this.setData(this.data)
},
inputAge: function(e) {
    this.data.inputAge = e.detail.value
    this.setData(this.data)
},

cbChange: function(e) {
    this.data.cbVal = e.detail.value
    this.setData(this.data)
},

radioChange: function(e) {
    this.data.radioVal = e.detail.value
    this.setData(this.data)
},

formSubmit: function(e) {
    console.log(e.detail)
}, // 点击提交后可以查看每一项的数据
formReset: function(e) {
    console.log(e.detail)
} // 点击重置后数据被清空
```

![image-20210115204633218](D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210115204633218.png)

![image-20210115204730591](D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210115204730591.png)

### 6、picker

选择器，主要有两个属性(range、value和mode)和一个绑定事件(bindchange)

range的值是一个数组，每个元素对应一个选项，当mode为selector或multiSelector时有效

value的值是数组对应的下标，表示要显示的数组元素的下标

mode表示选择器类型，默认是selector，其合法值如下：

| 值            | 说明         | 最低版本 |
| :------------ | :----------- | :------- |
| selector      | 普通选择器   |          |
| multiSelector | 多列选择器   |          |
| time          | 时间选择器   |          |
| date          | 日期选择器   |          |
| region        | 省市区选择器 |          |

当mode取不同的值时，有对应的不同的属性

```html
<view class="picker">
    <view>选择器picker</view>
    <picker name="course-picker" bindchange="pickerChange" range="{{courses}}" value="{{course_index}}">
        课程选择：{{courses[course_index]}}
    </picker>
    <picker name="number-picker" mode="multiSelector" bindchange="num_pickerChange" range="{{nums}}" value="{{num_index}}">
        数字选择：<text wx:for="{{num_index}}" wx:key="index">
            {{nums[index][num_index[index]]}}
        </text>
    </picker>
    <picker name="time" mode="time" bindchange="time_pickerChange" value="{{time}}" start="00:00" end="23:59">
        时间选择：{{time}}
    </picker>
    <picker name="date" mode="date" bindchange="date_pickerChange" value="{{date}}" start="2021-01-01" end="2021-12-31">
        日期选择：{{date}}
    </picker>
    <picker name="address" mode="region" bindchange="addr_pickerChange" value="{{address}}">
        当前选择的地区：{{address[0]}}/{{address[1]}}/{{address[2]}}
    </picker>
</view>
```

```js
data: {
	courses: ['数据结构', 'java', 'c++', 'javascript', 'HTML+CSS'],
    course_index: 0,
    nums: [['a', 'b', 'c'], ['c', 'd', 'e', 'f'], ['g', 'h']],
    num_index: [1, 3, 0],
    time: '',
    date: '',
    address: [
},
pickerChange: function(e) {
    this.setData({
        course_index: e.detail.value
    })
},
num_pickerChange: function(e) {
    this.setData({
        num_index: e.detail.value
    })
},
time_pickerChange: function(e) {
    this.setData({
        time: e.detail.value
    })
},
date_pickerChange: function(e) {
    this.setData({
        date: e.detail.value
    })
},
addr_pickerChange: function(e) {
    this.setData({
        address: e.detail.value
    })
},
```

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210116183630492.png" alt="image-20210116183630492" style="zoom:50%;" />

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210116183653543.png" alt="image-20210116183653543" style="zoom:50%;" />

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210116183713507.png" alt="image-20210116183713507" style="zoom:50%;" />

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210116183733932.png" alt="image-20210116183733932" style="zoom:50%;" />

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210116183750361.png" alt="image-20210116183750361" style="zoom:50%;" />

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210116183808555.png" alt="image-20210116183808555" style="zoom:50%;" />

### 7、slider

滑动选择器

```html
<view>
    滑动选择器
    <slider name="slider" bindchange="sliderChange" value="{{sliderVal}}" min="0" max="100" show-value="true" step="2" activeColor="#54de65"></slider>
</view>
```

```js
data: {
	sliderVal: 10
},
sliderChange: function(e) {
    this.setData({
        sliderVal: e.detail.value
    })
},
```

<img src="D:\GitHubRepository\小程序\小程序基础知识.assets\image-20210116185303955.png" alt="image-20210116185303955" style="zoom:50%;" />

### 8、switch

开关选择器

```html
<view>
    开关选择器
    <switch name="switch1" checked="{{switch_checked1}}" color="#987654" bindchange="switchChange" data-index="1"></switch>
    <switch name="switch2" checked="{{switch_checked2}}" type="checkbox" bindchange="switchChange" data-index="2"></switch>
    <switch disabled="true"></switch>
</view>
```

```js
data: {
	switch_checked1: true,
     switch_checked2: false
},
switchChange: function(e) {
    if(e.target.dataset.index === 1) {
        this.setData({
            switch_checked1: e.detail.value
        })
    } else {
        this.setData({
            switch_checked2: e.detail.value
        })
    }
},
```





